/*RODAR NO BACKUP*/
COPY frota_veiculo(id,bem_id, placa, renavam,ano,cor,combustivel,qtd_assento) 
TO '/home/raislan/Documentos/server/veiculo.csv' DELIMITER ',' CSV HEADER;

COPY frota_veiculo_percurso(veiculo_id, km_inicial, km_final,hora_inicial,
     hora_final,destino_percurso,motorista_id,solicitante,numero_sei,qtd_pessoas,status_percurso,link_sei_percurso) 
TO '/home/raislan/Documentos/server/percurso.csv' DELIMITER ',' CSV HEADER;

COPY frota_veiculo_despesa(veiculo_id, valor_gasto, tipo_gasto,
	  currency_id,complemento,motorista_id,numero_nota,empresa,link_sei_despesa) 
TO '/home/raislan/Documentos/server/despesa.csv' DELIMITER ',' CSV HEADER;



/*RODAR NO PRODUÇÃO*/

ALTER SEQUENCE frota_veiculo_id_seq RESTART WITH 6


COPY frota_veiculo(id,bem_id, placa, renavam,ano,cor,combustivel,qtd_assento)
FROM '/home/raislan/Documentos/server/veiculo.csv'
DELIMITER ','
CSV HEADER;

COPY frota_veiculo_percurso(veiculo_id, km_inicial, km_final,hora_inicial,
     hora_final,destino_percurso,motorista_id,solicitante,numero_sei,qtd_pessoas,status_percurso,link_sei_percurso)
FROM '/home/raislan/Documentos/server/percurso.csv'
DELIMITER ','
CSV HEADER;

COPY frota_veiculo_despesa(veiculo_id, valor_gasto, tipo_gasto,
	  currency_id,complemento,motorista_id,numero_nota,empresa,link_sei_despesa) 
FROM '/home/raislan/Documentos/server/despesa.csv' DELIMITER ',' CSV HEADER;



SELECT sum(atestado.dias) as afastamento,
CASE 
    WHEN partner.function = 'Servidor Carreira'
	OR  partner.function = 'Cargo Comissionado'
	OR  partner.function = 'Auxiliar Da Justica' THEN 'servidor' 
	WHEN partner.function = 'Magistrado' THEN 'Magistrado'
END AS categoria
from saude_atendimento_atestado as atestado
JOIN saude_atendimento_consulta AS consulta ON consulta.id = atestado.consulta_id
JOIN saude_paciente AS paciente ON paciente.id = consulta.paciente_id
JOIN res_partner AS partner ON partner.id = paciente.partner_id
where consulta.atestado = 'true' and EXTRACT(YEAR FROM consulta.create_date) = 2020 
and partner.function = 'Servidor Carreira'
or partner.function = 'Magistrado'
or partner.function = 'Cargo Comissionado'
or partner.function = 'Auxiliar Da Justica'
GROUP BY categoria


